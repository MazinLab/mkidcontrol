{% extends 'base.html' %}

{% block content %}
    <head>
        <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    </head>

    <div>Here's where the PICTURE-C Info will go. </div>
    <div>Hope it's good!</div>
    <h1>
        <a href="{{ url_for('index') }}"><button> Home </button></a>
    </h1>

    <div id="tester" style="width:600px;height:600px;"></div>
    <script>
        function init_temp() {
            var time = [];
            var temp = [];

            $.ajax({
                url: '/reporter',
                type: 'post',
                async: false,
                success: function(response) {
                    console.log(response)
                    temp = response['temps'];
                    time = response['times'];
                },
                error: function() {
                    temp = [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1];
                    time = [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1];
                }
            });
            // time.forEach(function(e) {
            //     Date(e).toLocaleTimeString("en-US")
            // });
            console.log('here')
            console.log(time)
            console.log(temp)

            var trace0 = {
                x: [time[0]],
                y: [temp[0]],
                mode: 'lines'
            };

            var trace1 = {
                x: [time[1]],
                y: [temp[1]],
                mode: 'lines'
            };

            var trace2 = {
                x: [time[2]],
                y: [temp[2]],
                mode: 'lines'
            };

            var trace3 = {
                x: [time[3]],
                y: [temp[3]],
                mode: 'lines'
            };

            var trace4 = {
                x: [time[4]],
                y: [temp[4]],
                mode: 'lines'
            };

            var trace5 = {
                x: [time[5]],
                y: [temp[5]],
                mode: 'lines'
            };

            var trace6 = {
                x: [time[6]],
                y: [temp[6]],
                mode: 'lines'
            };

            var trace7 = {
                x: [time[7]],
                y: [temp[7]],
                mode: 'lines'
            };

            var trace8 = {
                x: [time[8]],
                y: [temp[8]],
                mode: 'lines'
            };

            var trace9 = {
                x: [time[9]],
                y: [temp[9]],
                mode: 'lines'
            };

            var trace10 = {
                x: [time[10]],
                y: [temp[10]],
                mode: 'lines'
            };

            var trace11 = {
                x: [time[11]],
                y: [temp[11]],
                mode: 'lines'
            };

            var trace12 = {
                x: [time[12]],
                y: [temp[12]],
                mode: 'lines'
            };

            var trace13 = {
                x: [time[13]],
                y: [temp[13]],
                mode: 'lines'
            };

            var trace14 = {
                x: [time[14]],
                y: [temp[14]],
                mode: 'lines'
            };

            var data = [trace0, trace1, trace2, trace3, trace4, trace5, trace6, trace7, trace8, trace9, trace10, trace11, trace12, trace13, trace14];

            return data;
        }

        function grab() {
            var time = [];
            var temp = [];
            $.ajax({
                url: '/reporter',
                type: 'post',
                async: false,
                success: function(response) {
                    console.log(response)
                    temp = response['temps'];
                    time = response['times'];
                },
                error: function() {
                    temp = [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1];
                    time = [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1];
                }
            });
            // time.forEach(function(e) {
            //     Date(e).toLocaleTimeString("en-US")
            // })
            console.log(time)
            console.log(temp)
            return [time, temp];
        }
        console.log(init_temp())
        var hemt_data = init_temp()
        var layout = {
            title:'HEMT Data'
        };

        Plotly.newPlot('tester', hemt_data, layout);

        var interval = setInterval(function() {
            var new_data = grab();
            Plotly.extendTraces('tester', {
                x: [[new_data[0][0]], [new_data[0][1]], [new_data[0][2]], [new_data[0][3]], [new_data[0][4]], [new_data[0][5]], [new_data[0][6]], [new_data[0][7]], [new_data[0][8]], [new_data[0][9]], [new_data[0][10]], [new_data[0][11]], [new_data[0][12]], [new_data[0][13]], [new_data[0][14]]],
                y: [[new_data[1][0]], [new_data[1][1]], [new_data[1][2]], [new_data[1][3]], [new_data[1][4]], [new_data[1][5]], [new_data[1][6]], [new_data[1][7]], [new_data[1][8]], [new_data[1][9]], [new_data[1][10]], [new_data[1][11]], [new_data[1][12]], [new_data[1][13]], [new_data[1][14]]]
            }, [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14])
        }, 1000);
    </script>

{% endblock %}

