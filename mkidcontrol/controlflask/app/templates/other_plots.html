{% extends 'base.html' %}

{% block content %}
    {{ super() }}
    <div class="container-fluid">
        <div class="flex-row">
            <main role="main" class="col-10">
                <div class="d-flex justify-content-center align-content-center flex-wrap flex-md-nowrap py-2 mb-3 border-bottom">
                    <div class="flex-column col-6 border-right">
                        <div id="device_t" class="responsive-plot"></div>
                    </div>
                    <div class="flex-column col-6">
                        <div id="device_r" class="responsive-plot"></div>
                    </div>
                </div>
                <div class="d-flex justify-content-center align-content-center flex-wrap flex-md-nowrap py-2 mb-3 border-bottom">
                    <div class="flex-column col-6 border-right">
                        <div id="onek_t" class="responsive-plot"></div>
                    </div>
                    <div class="flex-column col-6">
                        <div id="onek_r" class="responsive-plot"></div>
                    </div>
                </div>
                <div class="d-flex justify-content-center align-content-center flex-wrap flex-md-nowrap py-2 mb-3 border-bottom">
                    <div class="flex-column col-6 border-right">
                        <div id="threek_t" class="responsive-plot"></div>
                    </div>
                    <div class="flex-column col-6">
                        <div id="threek_v" class="responsive-plot"></div>
                    </div>
                </div>
                <div class="d-flex justify-content-center align-content-center flex-wrap flex-md-nowrap py-2 mb-3 border-bottom">
                    <div class="flex-column col-6 border-right">
                        <div id="fiftyk_t" class="responsive-plot"></div>
                    </div>
                    <div class="flex-column col-6">
                        <div id="fiftyk_v" class="responsive-plot"></div>
                    </div>
                </div>
                <div class="d-flex justify-content-center align-content-center flex-wrap flex-md-nowrap py-2 mb-3 border-bottom">
                    <div class="flex-column col-6 border-right">
                        <div id="magnet_i" class="responsive-plot"></div>
                    </div>
                    <div class="flex-column col-6">
                        <div id="magnet_f" class="responsive-plot"></div>
                    </div>
                </div>
                <div class="d-flex justify-content-center align-content-center flex-wrap flex-md-nowrap py-2 mb-3 border-bottom">
                    <div class="flex-column col-6 border-right">
                        <div id="ls625_ov" class="responsive-plot"></div>
                    </div>
                </div>
            </main>
        </div>
    </div>


    <script>

        var plots = {{ plots | safe }};
        var ids = {{ ids | safe }};

        Plotly.newPlot('device_t', {{ plots[0] | safe }}) //, {{ devT | safe }})
        Plotly.newPlot('device_r', {{ plots[1] | safe }}) //, {{ devR | safe }})
        Plotly.newPlot('onek_t', {{ plots[2] | safe }}) //, {{ onekT | safe }}})
        Plotly.newPlot('onek_r', {{ plots[3] | safe }}) //, {{ onekR | safe }})
        Plotly.newPlot('threek_t', {{ plots[4] | safe }}) //, {{ threekT | safe }}})
        Plotly.newPlot('threek_v', {{ plots[5] | safe }}) //, {{ threekV | safe }})
        Plotly.newPlot('fiftyk_t', {{ plots[6] | safe }}) //, {{ fiftykT | safe }}})
        Plotly.newPlot('fiftyk_v', {{ plots[7] | safe }}) //, {{ fiftykV | safe }})
        Plotly.newPlot('magnet_i', {{ plots[8] | safe }}) //, {{ magI | safe }})
        Plotly.newPlot('magnet_f', {{ plots[9] | safe }}) //, {{ magF | safe }})
        Plotly.newPlot('ls625_ov', {{ plots[10] | safe }}) //, {{ ls625ov | safe }})


        function update_plots() {
            var ids = {{ ids | safe }}
            for (let i = 0; i < ids.length; i++) {
                console.log(i, ids[i]);
            }
            var psource = new EventSource('{{url_for("main.plotdata")}}');
            psource.addEventListener("plot", function (event) {
                var update = JSON.parse(event.data);
                var elem = document.getElementById(update['id']);
                if (elem) {
                    switch (update['kind']) {
                        case "full":
                            Plotly.react(update['id'], JSON.parse(update['data']));
                            break;
                        case "partial":
                            Plotly.extendTraces(update['id'], {x: [update['data']['x']], y: [update['data']['y']]}, [0]);
                            break;
                    }
                }
            }, false);
            psource.addEventListener("open", function (e) {console.log('Connection was opened: ', e);}, false);
            psource.addEventListener("error", function (e) {console.log("Connection errored out: ", e);}, false);
        }
        update_plots()
    </script>

{% endblock %}